{"version":3,"sources":["../src/ColumnManager.js"],"names":["FrozenDirection","ColumnManager","columns","fixed","_origColumns","reset","_cache","key","fn","_cached","_columns","map","column","width","resizable","idx","findIndex","x","_fixed","_columnStyles","recomputeColumnStyles","resetCache","getOriginalColumns","getColumns","getVisibleColumns","filter","hidden","hasFrozenColumns","some","frozen","hasLeftFrozenColumns","LEFT","hasRightFrozenColumns","RIGHT","getMainColumns","mainColumns","getLeftFrozenColumns","forEach","push","PlaceholderKey","getRightFrozenColumns","getColumn","getColumnsWidth","recomputeColumnsWidth","getLeftFrozenColumnsWidth","getRightFrozenColumnsWidth","reduce","setColumnWidth","recomputeColumnStyle","getColumnStyle","getColumnStyles","flexGrow","flexShrink","flexValue","style","flex","msFlex","WebkitFlex","overflow","maxWidth","minWidth","styles"],"mappings":"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","sourcesContent":["import { FrozenDirection } from './Column';\n\nexport default class ColumnManager {\n  constructor(columns, fixed) {\n    this._origColumns = [];\n    this.reset(columns, fixed);\n  }\n\n  _cache(key, fn) {\n    if (key in this._cached) return this._cached[key];\n    this._cached[key] = fn();\n    return this._cached[key];\n  }\n\n  reset(columns, fixed) {\n    this._columns = columns.map(column => {\n      let width = column.width;\n      if (column.resizable) {\n        // don't reset column's `width` if `width` prop doesn't change\n        const idx = this._origColumns.findIndex(x => x.key === column.key);\n        if (idx >= 0 && this._origColumns[idx].width === column.width) {\n          width = this._columns[idx].width;\n        }\n      }\n      return { ...column, width };\n    });\n    this._origColumns = columns;\n    this._fixed = fixed;\n    this._cached = {};\n    this._columnStyles = this.recomputeColumnStyles();\n  }\n\n  resetCache() {\n    this._cached = {};\n  }\n\n  getOriginalColumns() {\n    return this._origColumns;\n  }\n\n  getColumns() {\n    return this._columns;\n  }\n\n  getVisibleColumns() {\n    return this._cache('visibleColumns', () => {\n      return this._columns.filter(column => !column.hidden);\n    });\n  }\n\n  hasFrozenColumns() {\n    return this._cache('hasFrozenColumns', () => {\n      return this._fixed && this.getVisibleColumns().some(column => !!column.frozen);\n    });\n  }\n\n  hasLeftFrozenColumns() {\n    return this._cache('hasLeftFrozenColumns', () => {\n      return (\n        this._fixed &&\n        this.getVisibleColumns().some(column => column.frozen === FrozenDirection.LEFT || column.frozen === true)\n      );\n    });\n  }\n\n  hasRightFrozenColumns() {\n    return this._cache('hasRightFrozenColumns', () => {\n      return this._fixed && this.getVisibleColumns().some(column => column.frozen === FrozenDirection.RIGHT);\n    });\n  }\n\n  getMainColumns() {\n    return this._cache('mainColumns', () => {\n      const columns = this.getVisibleColumns();\n      if (!this.hasFrozenColumns()) return columns;\n\n      const mainColumns = [];\n      this.getLeftFrozenColumns().forEach(column => {\n        //columns placeholder for the fixed table above them\n        mainColumns.push({ ...column, [ColumnManager.PlaceholderKey]: true });\n      });\n      this.getVisibleColumns().forEach(column => {\n        if (!column.frozen) mainColumns.push(column);\n      });\n      this.getRightFrozenColumns().forEach(column => {\n        mainColumns.push({ ...column, [ColumnManager.PlaceholderKey]: true });\n      });\n\n      return mainColumns;\n    });\n  }\n\n  getLeftFrozenColumns() {\n    return this._cache('leftFrozenColumns', () => {\n      if (!this._fixed) return [];\n      return this.getVisibleColumns().filter(\n        column => column.frozen === FrozenDirection.LEFT || column.frozen === true\n      );\n    });\n  }\n\n  getRightFrozenColumns() {\n    return this._cache('rightFrozenColumns', () => {\n      if (!this._fixed) return [];\n      return this.getVisibleColumns().filter(column => column.frozen === FrozenDirection.RIGHT);\n    });\n  }\n\n  getColumn(key) {\n    const idx = this._columns.findIndex(column => column.key === key);\n    return this._columns[idx];\n  }\n\n  getColumnsWidth() {\n    return this._cache('columnsWidth', () => {\n      return this.recomputeColumnsWidth(this.getVisibleColumns());\n    });\n  }\n\n  getLeftFrozenColumnsWidth() {\n    return this._cache('leftFrozenColumnsWidth', () => {\n      return this.recomputeColumnsWidth(this.getLeftFrozenColumns());\n    });\n  }\n\n  getRightFrozenColumnsWidth() {\n    return this._cache('rightFrozenColumnsWidth', () => {\n      return this.recomputeColumnsWidth(this.getRightFrozenColumns());\n    });\n  }\n\n  recomputeColumnsWidth(columns) {\n    return columns.reduce((width, column) => width + column.width, 0);\n  }\n\n  setColumnWidth(key, width) {\n    const column = this.getColumn(key);\n    column.width = width;\n    this._cached = {};\n    this._columnStyles[column.key] = this.recomputeColumnStyle(column);\n  }\n\n  getColumnStyle(key) {\n    return this._columnStyles[key];\n  }\n\n  getColumnStyles() {\n    return this._columnStyles;\n  }\n\n  recomputeColumnStyle(column) {\n    let flexGrow = 0;\n    let flexShrink = 0;\n    if (!this._fixed) {\n      flexGrow = typeof column.flexGrow === 'number' ? column.flexGrow : 0;\n      flexShrink = typeof column.flexShrink === 'number' ? column.flexShrink : 1;\n    }\n    // workaround for Flex bug on IE: https://github.com/philipwalton/flexbugs#flexbug-7\n    const flexValue = `${flexGrow} ${flexShrink} auto`;\n\n    const style = {\n      ...column.style,\n      flex: flexValue,\n      msFlex: flexValue,\n      WebkitFlex: flexValue,\n      width: column.width,\n      overflow: 'hidden',\n    };\n\n    if (!this._fixed && column.maxWidth) {\n      style.maxWidth = column.maxWidth;\n    }\n    if (!this._fixed && column.minWidth) {\n      style.minWidth = column.minWidth;\n    }\n\n    return style;\n  }\n\n  recomputeColumnStyles() {\n    return this._columns.reduce((styles, column) => {\n      styles[column.key] = this.recomputeColumnStyle(column);\n      return styles;\n    }, {});\n  }\n}\n\nColumnManager.PlaceholderKey = '__placeholder__';\n"],"file":"ColumnManager.js"}